<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="html 5 template">
    <meta name="author" content="tonytemplates.com">
    <link rel="icon" href="favicon.ico">
    <title>订单改签</title>
    <!-- Bootstrap core CSS -->
    <link href="../css/plugins/bootstrap.min.css" rel="stylesheet">
    <link href="../css/plugins/bootstrap-submenu.css" rel="stylesheet">
    <link href="../css/plugins/animate.min.css" rel="stylesheet">
    <link href="../css/plugins/nivo-slider.css" rel="stylesheet">
    <link href="../css/plugins/slick.css" rel="stylesheet">
    <link href="../css/plugins/magnific-popup.css" rel="stylesheet">
    <link href="../css/custom.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icon Font-->
    <link href="../iconfont/style.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link
            href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,400,500,700,900"
            rel="stylesheet">
    <!-- Google map -->
    <!---<script type="text/javascript" src="http://ditu.google.cn/maps/api/js"></script>--->
</head>

<body class="home">
<!-- Loader -->
<div id="loader-wrapper" class="loader-on">
    <div id="loader">
        <div class="loader">
            <div class="bolt one">
                <div class="other"></div>
            </div>
            <div class="bolt two">
                <div class="other"></div>
            </div>
            <div class="bolt three">
                <div class="other"></div>
            </div>
            加载中
        </div>
    </div>
</div>
<!-- //Loader -->
<!-- Header -->
<header class="page-header">
    <!-- Fixed navbar -->
    <nav class="navbar" id="slide-nav">
        <div class="container">
            <div class="navbar-header">
                <div class="header-top">
                    <div class="row">
                        <div class="col-sm-4">

                        </div>
                        <div class="col-sm-4 text-center">
                            <div class="logo">
                                <a href="index.html"><img src="../images/logo.png"
                                                          alt="Logo"> <span><img src="../images/bolt.gif"
                                                                                 alt=""></span></a>
                            </div>
                        </div>

                    </div>
                </div>
                <button type="button" class="navbar-toggle">
                    <i class="icon icon-interface icon-menu"></i><i
                        class="icon icon-cancel"></i>
                </button>
            </div>
            <div id="slidemenu" data-hover="dropdown" data-animations="fadeIn">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="index.html"><span class="electric-btn"><span class="text">首页</span></span></a></li>
                    <li><a href="orderForm.html"><span class="electric-btn"><span class="text">订单</span></span></a></li>
                    <li><a href="prices.html"><span class="electric-btn"><span class="text">火车票</span></span></a></li>
                    <li><a href="contact.html"><span class="electric-btn"><span class="text">个人信息</span></span></a></li>
                    <li onclick="returnIndex()"><a href="login.html"><span class="electric-btn"><span class="text">注销</span></span></a></li>
                </ul>

            </div>
            <div id="slidemenu1" data-hover="dropdown" data-animations="fadeIn">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="index.html"><span class="electric-btn"><span class="text">订单信息</span></span></a></li>
                    <li><a href="orderRefund.html"><span class="electric-btn"><span class="text">退票处理</span></span></a></li>
                    <li><a href="ticketchange.html"><span class="electric-btn"><span class="text">改签</span></span></a></li>
                </ul>
            </div>

        </div>
    </nav>
</header>
<!-- // Header -->
<!-- Content  -->
<div id="page-content">
    <!-- Breadcrumbs Block -->
    <div class="container">
        <div class="breadcrumbs">
            <ul class="breadcrumb">
                <li><a href="index.html">首页</a></li>
                <li class="active">订票</li>
            </ul>
        </div>
    </div>
    <!-- //Breadcrumbs Block -->
    <!-- Block -->

</div>
<!-- // Content  -->



<!-- //Block -->
<!-- Block -->
<div class="block">
    <div class="container">
        <h1 class="text-center">
            改签 <b>可供选择的车次</b>
        </h1>
        <p class="font24 text-center">先进行退票处理在重新选择车票</p>
        <form id="queryform" class="contact-form" name="queryform"
              method="post" novalidate>
            <div id="success">
                <p>信息查询成功！</p>
            </div>
            <div id="error">
                <p>信息查询出错！请再次查询！</p>
            </div>
            <div class="inputs-col">
                <div class="row">
                    <div class="col-md-6">
                        <div class="input-wrapper">
                            <label>始发城市<span class="required"></span></label> <input
                                type="text" class="input-custom input-full" id="source"
                                placeholder="请输入你的出发地点">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="input-wrapper">
                            <label>目的城市</label> <input type="text"
                                                       class="input-custom input-full" id="target"
                                                       placeholder="请输入你的目的地">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="input-wrapper">
                            <label id ="date"></label>
                        </div>
                    </div>
                </div>
                <button type="submit" id="submit" class="btn btn-border">
                    <span>查询</span>
                </button>
            </div>
        </form>
        <div class="table-wrapper">
            <table id="ticketTable" class="table price-table">
                <tbody>
                <tr class="table-header">
                    <th>始发地</th>
                    <th>出发时间</th>
                    <th>目的地</th>
                    <th>到达时间</th>
                    <th>班次号</th>
                    <th>价格</th>
                    <th>数量</th>
                    <th>操作</th>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>


<div class="block">
    <div class="container">

        <div class="col-sm-1 visible-lg"></div>
        <div class="col-sm-7 col-md-8">
            <form id="ticketform" class="contact-form" name="ticketform"
                  method="post" novalidate>
                <div id="success">
                    <p>您的信息更新成功！</p>
                </div>
                <div id="error">
                    <p>信息更新出错！请再次提交！</p>
                </div>
                <div class="inputs-col">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>姓名 <span class="required"></span></label> <input
                                    type="text" class="input-custom input-full" id="trueName" name="trueName">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>电话</label> <input type="text"
                                                         class="input-custom input-full" id="phone" name="phone">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>身份证号 <span class="required"></span></label> <input
                                    type="text" class="input-custom input-full" id="identity" name="identity">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>车次号</label> <input type="text"
                                                          class="input-custom input-full" id="carNum" name="carNum">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>始发地 <span class="required"></span></label> <input
                                    type="text" class="input-custom input-full" id="orginLocation" name="orginLocation">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>目的地</label> <input type="text"
                                                          class="input-custom input-full" id="destinationLocation" name="destinationLoction">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>出发时间 <span class="required"></span></label> <input
                                    type="text" class="input-custom input-full" id="startTime" name="startTime">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>到达时间</label> <input type="text"
                                                           class="input-custom input-full" id="reachTime" name="reachTime">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-wrapper">
                                <label>价格 <span class="required"></span></label> <input
                                    type="text" class="input-custom input-full" id="ticketPrice" name="ticketPrice">
                            </div>
                        </div>
                    </div>
                </div>
                <button type="submit" id="submit" class="btn btn-border">
                    <i class="icon icon-lightning"></i><span>付款</span>
                </button>
            </form>
        </div>
    </div>
</div>
</div>

<script src="../js/jquery.js"></script>
<script src="../js/plugins/bootstrap.min.js"></script>
<script src="../js/plugins/slick.min.js"></script>
<script src="../js/plugins/jquery.form.js"></script>
<script src="../js/plugins/jquery.validate.min.js"></script>
<script src="../js/custom.js"></script>
<script language="JavaScript">
    fillerIn()
    var json = [];
    var storage = window.localStorage;
    var username = storage["username"];
    // ajax传递数据
    var json = {
        "username" : username
    } // 这里的orderId是指订单id,tripsId是指新车票的id
    // ajax提交数据
    $.ajax({
        type : 'POST',
        url : base_url +'/getorder',
        data : JSON.stringify(json),
        contentType : 'application/json;charset=utf-8',
        dataType : 'json',
        success : function(data) {
            if (data.stateCode === 200) {
                // 订单信息查询成功
                console.log("11")
                console.log(data.data)
                console.log("查询订单信息成功，呈现到订单信息的页面当中");
                //暂时的解决掉数据的参数传递问题
                window.localStorage.setItem("orderItem",JSON.stringify(data.data));
                json = JSON.stringify(data.data)
                // $("#orderTable").html("");
                $("#orderTable").siblings(
                    'tr'
                ).remove()



                for (var i= 0;i<data.data.length; i++) {
                    var tr;
                    tr = '<td>' + data.data[i].trueName + '</td>' + '<td>'
                        + data.data[i].orginLocation + '</td>' + '<td>'
                        + data.data[i].startTime + '</td>' + '<td>'
                        + data.data[i].destinationLocation + '</td>'
                        + '<td>' + data.data[i].reachTime + '</td>'
                        + '<td>' + data.data[i].carNum + '</td>' + '<td>'
                        + data.data[i].ticketPrice + '</td>' + '<td>'
                        + data.data[i].status + '</td>' + '<td>'
                        + '<button onclick="orderDetail(' + i + ')'+'">查看</button>'
                        + '</td>';
                    $("#orderTable").append('<tr>' + tr + '</tr>');
                }
            } else
                // 查询失败,错误信息在data.msg里面（未填写个人信息，请完善个人信息）
                alert("错误信息：" + data.msg)

        }
    })

    function refund1() {
        console.log("实现用户退票的操作");
        //获取身份证号，车次号，出发时间，始发地
        // var idCardNum = $("#identity").val();
        // var carNum = $("#carNum").val();
        var carNum = $("#carNum").val();
        var startTime = $("#startTime").val();
        var reachTime = $("#reachTime").val();
        var json = {
            "username" : window.localStorage.getItem("username"),
            "carNum" : carNum,
            "startTime" : startTime,
            "reachTime" : reachTime
        }
        // ajax提交数据
        $.ajax({
            type:'POST',
            url: base_url +'/ticketrefund',
            data:JSON.stringify(json),
            contentType:'application/json;charset=utf-8',
            dataType:'json',
            success : function(data) {
                if (data.stateCode == "200") {
                    // 个人信息查询成功
                    console.log("退票成功，呈现到个人信息的页面当中");
                    window.location.href = 'orderForm.html';
                } else
                    // 查询失败,错误信息在data.msg里面（未填写个人信息，请完善个人信息）
                    alert("错误信息：" + data.msg)
            }
        })
    }
    function orderDetail(i) {
        // 在当前界面当中填充好详细信息然后再实现改签等的操作
        $("#trueName").val('');
        $("#phone").val('');
        $("#identity").val('');
        $("#carNum").val('');
        $("#orginLocation").val('');
        $("#destinationLocation").val('');
        $("#startTime").val('');
        $("#reachTime").val('');
        $("#ticketPrice").val('');
        var data = JSON.parse(json);
        console.log(data)
        console.log(i)
        data = data[i];
        console.log("用户点击某个订单呈现出详细信息");
        $("#trueName").val(data.trueName);
        $("#phone").val(data.phoneNum);
        $("#identity").val(data.idCardNum);
        $("#carNum").val(data.carNum);
        $("#orginLocation").val(data.orginLocation);
        $("#destinationLocation").val(data.destinationLocation);
        $("#startTime").val(data.startTime);
        $("#reachTime").val(data.reachTime);
        $("#ticketPrice").val(data.ticketPrice);
    }
</script>


</body>
</html>
